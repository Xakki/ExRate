# 2026-02-18

**Prompt**: Переделываем \App\Contract\ProviderInterface::getAvailableCurrencies в массив кодов валют. Из метода \App\Provider\FredProvider::getAvailableCurrencies() нужно параметр observationStart перенести в SERIES_MAP, и в FredProvider::getRatesByDate использовать $config['observationStart'] вместо $currencyDto->getObservationStart(). В \App\DTO\Provider тоже currencies будет массив строк
**Implementation Plan**:
1. Updated `ProviderInterface::getAvailableCurrencies()` to return `string[]`.
2. Refactored `FredProvider`:
    - Moved `observationStart` from `Currency` DTOs to `SERIES_MAP` constant.
    - Updated `getAvailableCurrencies()` to return `array_keys(self::SERIES_MAP)`.
    - Refactored `getRatesByDate()` to use `observationStart` from `SERIES_MAP`.
3. Updated `Provider` DTO to use `string[]` for `currencies` property and updated OpenAPI attributes.
4. Refactored all other 29 providers to return a simple array of currency codes instead of `Currency` DTOs.
5. Updated `SyncProviderCurrenciesCommand` to handle the new array format.
6. Updated `ProviderImporter::checkCurrencyConsistency` to work with the new return type.
7. Updated `ProviderImporterTest` to match the new interface.
8. Removed unused `App\DTO\Currency` and `App\Enum\FrequencyEnum`.
9. Updated `AllProviderTest` integration test to handle the new currency array format.
10. Verified with unit/functional/integration (partial) tests and PHPStan.
**Git Comment Summary**: Refactor ProviderInterface to return simple currency code array and simplify FredProvider metadata

---

**Prompt**: В \App\DTO\RateRequest::validateDateRange , валидация MinDate() должна учитывать выбранного провайдера.
**Implementation Plan**:
1. Modified `ExchangeRateRepository::getMinDate(?int $providerId = null)` to support filtering by provider ID.
2. Updated `MinDate` constraint to include a `provider` property and a constructor that supports named arguments.
3. Updated `MinDateValidator` to inject `ProviderRegistry`, get the provider ID from the constraint's provider, and pass it to the repository.
4. Updated `RateRequest::validateDateRange` to pass the current provider to the `MinDate` constraint.
5. Verified changes with functional tests and static analysis.
**Git Comment Summary**: Update MinDate validation to consider the selected provider in RateRequest

---

**Prompt**: в \App\DTO\Provider добавить вывод наименьшей даты этого провайдера из \App\Repository\ExchangeRateRepository::getMinDate
**Implementation Plan**:
1. Updated `App\DTO\Provider` to include an optional `minDate` string property.
2. Modified `App\Service\ProviderRegistry` constructor to inject `ExchangeRateRepository`.
3. Updated `App\Service\ProviderRegistry::getAll()` to fetch the minimum date for each provider and pass it to the `Provider` DTO.
4. Verified with functional tests and static analysis.
**Git Comment Summary**: Add minDate to Provider DTO fetching it from repository

